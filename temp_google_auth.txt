// Replace your handleGoogleSignIn function with this:

const handleGoogleSignIn = async () => {
  try {
    setIsLoading(true);
    console.log('ğŸ”µ Starting Google sign-in...');
    console.log('ğŸ”µ Platform:', Platform.OS);
    
    // Create proper redirect URI for the platform
    const redirectUri = AuthSession.makeRedirectUri({
      scheme: "mygallery",
      path: "/auth/callback",
    });
    
    console.log('ğŸ”µ Redirect URI:', redirectUri);
    
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider: "google",
      options: {
        redirectTo: redirectUri,
        skipBrowserRedirect: true, // Important for mobile
      },
    });
    
    if (error) {
      console.error('ğŸ”´ Supabase OAuth error:', error);
      throw error;
    }
    
    console.log('ğŸ”µ Opening OAuth URL:', data.url);
    
    const result = await WebBrowser.openAuthSessionAsync(
      data.url,
      redirectUri
    );
    
    console.log('ğŸ”µ Auth result:', result);
    
    if (result.type === "success") {
      const url = result.url;
      console.log('ğŸ”µ Success URL:', url);
      
      // Exchange the code for a session
      const { data: sessionData, error: sessionError } =
        await supabase.auth.exchangeCodeForSession(url);
        
      if (sessionError) {
        console.error('ğŸ”´ Session error:', sessionError);
        throw sessionError;
      } else {
        console.log('âœ… Logged in:', sessionData.session?.user?.email);
        Alert.alert('ğŸ‰ Success!', 'Logged in with Google successfully!');
      }
    } else if (result.type === 'cancel') {
      console.log('âŒ User cancelled Google auth');
      return;
    }
    
  } catch (error: any) {
    console.error('ğŸ”´ Google Sign-In Error:', error);
    Alert.alert(
      'Authentication Error',
      `Failed to sign in with Google: ${error.message || 'Unknown error'}`,
      [{ text: 'OK' }]
    );
  } finally {
    setIsLoading(false);
  }
};